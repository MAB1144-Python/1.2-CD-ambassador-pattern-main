# ImplementaciÃ³n del PatrÃ³n Ambassador con NGINX y Docker

Este proyecto demuestra la implementaciÃ³n del **PatrÃ³n Ambassador** con **NGINX** en un entorno **Docker**. Se utiliza un servicio de NGINX como embajador para distribuir las solicitudes entrantes entre dos servidores backend, enviando **el 90% del trÃ¡fico al servidor principal y el 10% al servidor experimental**.

---

## ğŸ› ï¸ TecnologÃ­as utilizadas
- Docker
- Docker Compose
- NGINX
- Python (Flask)

---

## ğŸ“ Estructura del Proyecto
```bash
ambassador-pattern/
â”‚-- nginx/
â”‚   â”‚-- nginx.conf
â”‚   â””-- Dockerfile
â”‚-- backend/
â”‚   â”‚-- main_server.py
â”‚   â”‚-- exp_server.py
â”‚   â””-- Dockerfile
â”‚-- docker-compose.yml
â”‚-- README.md
```

---

## ğŸ’¡ ConfiguraciÃ³n y Archivos Clave

### **1. ConfiguraciÃ³n de NGINX (`nginx/nginx.conf`)**
Este archivo configura NGINX para dividir el trÃ¡fico entre los servidores backend usando `split_clients`.
```nginx
events {}

http {
    split_clients "${remote_addr}" $backend {
        90% "main";
        10% "exp";
    }

    upstream main {
        server main:5000;
    }

    upstream exp {
        server exp:5000;
    }

    server {
        listen 80;

        location / {
            proxy_pass http://$backend;
        }
    }
}
```

### **2. Servidores Backend**

#### **Servidor Principal (`backend/main_server.py`)**
```python
from flask import Flask

app = Flask(__name__)

@app.route('/')
def main():
    return "Response from Main Server"

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
```

#### **Servidor Experimental (`backend/exp_server.py`)**
```python
from flask import Flask

app = Flask(__name__)

@app.route('/')
def experiment():
    return "Response from Experimental Server"

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
```

### **3. ConfiguraciÃ³n de Docker**
#### **Dockerfile para NGINX (`nginx/Dockerfile`)**
```dockerfile
FROM nginx:alpine
COPY nginx.conf /etc/nginx/nginx.conf
```

#### **Dockerfile para los servidores (`backend/Dockerfile`)**
```dockerfile
FROM python:3.9
WORKDIR /app
COPY . .
RUN pip install flask
CMD ["python", "main_server.py"]
```

---

## ğŸ› ï¸ ConfiguraciÃ³n y EjecuciÃ³n

1. **Clonar el repositorio**
   ```bash
   git clone https://github.com/tu-repositorio/ambassador-pattern.git
   cd ambassador-pattern
   ```

2. **Construir y ejecutar los contenedores**
   ```bash
   docker-compose up --build
   ```

3. **Probar la configuraciÃ³n**
   Abre un navegador o usa `curl` para enviar solicitudes a `localhost:8080`:
   ```bash
   curl http://localhost:8080
   ```
   El 90% de las veces responderÃ¡ `Response from Main Server` y el 10% `Response from Experimental Server`.

4. **Detener los contenedores**
   ```bash
   docker-compose down
   ```

---

## ğŸŒŸ Mejoras Futuras
- Implementar una versiÃ³n en **Kubernetes**.
- Hacer que la divisiÃ³n de trÃ¡fico sea configurable mediante variables de entorno.
- Integrar con herramientas de monitoreo como **Prometheus y Grafana**.

---

## ğŸ‘¤ Autor
**Tu Nombre**  
[GitHub](https://github.com/tu-usuario) | [LinkedIn](https://linkedin.com/in/tu-usuario)

ğŸ’ª Â¡Gracias por probar este proyecto! ğŸŒŸ
